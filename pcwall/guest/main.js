!function(){Hi.Push.r("updateWallGuest",function(e){Hi.Note.n(Hi.Note.type.UPDATE_WALL_GUEST,e)});var e=function(e){$(document).bind("keyup.space",function(e){"block"==$("#guest-wall-block .guestwall").css("display")?($("#guest-wall-block .guestwall").fadeOut(500),$("#guest-wall-block #guestPop").slideDown(500)):($("#guest-wall-block .guestwall").fadeIn(500),$("#guest-wall-block #guestPop").slideUp(500))}),$(document).bind("keyup.up",function(e){$("#prevPage").click()}),$(document).bind("keyup.down",function(e){$("#nextPage").click()})},t=function(){$(document).unbind("keyup.space"),$(document).unbind("keyup.up"),$(document).unbind("keyup.down")},l=function(e){this.initAlready=!1,this.wall=e,this.userList=[],this.curIndex=0};l.prototype.init=function(){var e=$.Deferred(),t=this;if(t.initAlready)return void e.resolve();this.initAlready=!0,Hi.Note.r(Hi.Note.type.UPDATE_WALL_GUEST,function(e){t.updateUserList(function(e){e&&t.render()})});var l=function(){var e=$.Deferred();return t.updateUserList(function(t){e.resolve()}),e.promise()};return Hi.Load.moduleHtml("guest").then(l).always(function(){e.resolve()}),e.promise()},l.prototype.in=function(){var t=this;$("#guest-wall-block").show(),$("#wallNote,#wallcopyright").css("visibility","hidden"),$("#guest-wall-block .guestwall ul").delegate("li","click",function(){var e=$(this).attr("data-id");t.renderInfo(e)&&($("#guest-wall-block .guestwall").fadeOut(500),$("#guest-wall-block #guestPop").slideDown(500))}),$("#guestPop").bind("click",function(){$("#guest-wall-block .guestwall").fadeIn(500),$("#guest-wall-block #guestPop").slideUp(500)}),$("#wallcontrol .fr").hide(),$("#play-handle").show(),$("#firstPage,#lastPage,#playPause").hide(),$("#prevPage").bind("click",function(){var e=t.curIndex-1;e<0&&(e=t.userList.length-1);var l=$("#guest-wall-block .guestwall ul li").eq(e).attr("data-id");t.renderInfo(l)}),$("#nextPage").bind("click",function(){var e=t.curIndex+1;e>t.userList.length-1&&(e=0);var l=$("#guest-wall-block .guestwall ul li").eq(e).attr("data-id");t.renderInfo(l)}),e(t),t.render()},l.prototype.leave=function(){$("#guest-wall-block").hide(),$("#wallNote,#wallcopyright").css("visibility","visible"),$("#prevPage,#nextPage").unbind("click"),$("#guest-wall-block .guestwall ul").undelegate(),$("#firstPage,#lastPage,#playPause").show(),$("#wallcontrol .fr").hide(),t()},l.prototype.updateUserList=function(e){var t=!1,l=this;try{Hi.Dc.query({where:{wallGuestListByFlag:flag},sort:{sortNum:"asc",createDate:"desc"}}).post("/web/wallguest/list.html",function(i,s){var u=JSON.stringify(l.userList);JSON.stringify(s);u!=l.userList&&(t=!0),l.userList=s,e(t),!l.curIndex&&s.length&&l.renderInfo(s[0].id)})}catch(l){console.log("WallGuest","updateUserList","嘉宾列表更新失败",l),e(t)}},l.prototype.render=function(){var e=this;if(e.userList.length>0){$("#guest-wall-block .guestwall ul").empty();for(var t="",l=0;l<e.userList.length;l++){var i=e.userList[l];t+='<li data-id="'+i.id+'">';var s=i.head;s=s?Hi.String.dealUrl(i.head):"/images/set/defaultguest.png",t+='<div class="pic"><img src="'+s+'" alt=""></div>',t+='<div class="name">'+i.userName+"</div>",t+="<p>"+(i.introduction||"")+"</p>",t+="</li>"}$("#guest-wall-block .guestwall ul").append(t)}},l.prototype.renderInfo=function(e){var t=this;if(t.userList.length>0){for(var l=null,i=0;i<t.userList.length;i++)if(e==t.userList[i].id){l=t.userList[i],t.curIndex=i;break}if(null!=l)return $("#guestPop .fl .pic img").attr("src",Hi.String.dealUrl(l.head)||"/images/set/defaultguest.png"),$("#guestPop .fl .name").text(l.userName),$("#guestPop .fl p").text(l.introduction||""),$("#guestPop .description").html(l.description||""),!0}return!1};var i=new l;Hi.Activity.r("guest",i)}(jQuery);