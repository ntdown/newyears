!function(){var n=function(){this.modeName="sign",this.onWallSignIn=[],this.wallapplysignConfig=null,this.dbUtil=new Hi.DbUtil(flag,"sign")};n.prototype.init=function(){var n=$.Deferred(),e=this,i=function(){new Hi.DbUtil(flag,e.modeName).count().then(function(n){$("#signinUserCount span").text(n)})},t=function(){var n=$.Deferred(),i=function(){var n=$.Deferred();return Hi.Message.init("sign").always(n.resolve),n.promise()},t=function(){var n=$.Deferred();return $.indexedDB(flag).objectStore(e.modeName,"readonly").each(function(n){var e=n.value.data;Hi.Wall.data.signUsers[e.id]=e}).done(n.resolve),n.promise()};return i().then(t).always(n.resolve),n.promise()},a=function(){var n=$.Deferred();return Hi.Db.get("global","wallapplysignConfig").then(function(i){e.wallapplysignConfig=i,n.resolve()},function(){console.error("查询失败")}),n.promise()},o=function(){var n=$.Deferred();return Hi.Note.r(Hi.Note.type.UPDATE_GLOBAL,function(n){"wallapplysignConfig"==n.noteType&&(e.wallapplysignConfig=n)}),Hi.Note.r("new"+e.modeName,function(){i()}),i(),n.resolve(),n.promise()};return t().then(a).then(o).always(n.resolve),n.promise()},n.prototype.in=function(){Hi.Control.bindEvent();var n=this;$("#wallcontrol .fr").hide(),$("#play-handle").show().css("opacity","0"),$("#play-handle a").css("pointer-events","none"),$("#applysign-wall-block,#signinUserCount").show(),Hi.Control.time(3).fn=function(){var e=$.Deferred();return n.nextPage(function(){e.resolve()}),e.promise()},Hi.Control.go()},n.prototype.leave=function(){Hi.Control.stop(),Hi.Control.unbindEvent(),$("#applysign-wall-block").find("li>div").removeClass("rotate"),$("#applysign-wall-block,#signinUserCount").hide(),$("#play-handle").css("opacity","1").hide(),$("#play-handle a").css("pointer-events","auto")},n.prototype.nextPage=function(n){var e=this;e.dbUtil.getMsg(e.onWallSignIn,"next",1).then(function(n){if(n.length){var i=n[0];$(".signIn_list li>div").addClass("in").removeClass("rotate"),e.animation(i.data,"next")&&e.onWallSignIn.push(i)}},function(){console.log("fail")}).always(n)},n.prototype.animation=function(n,e){var i=n.id,t=Hi.Wall.getSignUserName(i,n.nickName);if($('.signIn_list li[data-id="'+i+'"]').length)return!0;var a="/images/wall/unname.jpg";n.imgPath&&(a=Hi.String.dealUrl(n.imgPath));var o='<li data-id="'+i+'"><div class="use-block rotate"><a href="javascript:;"><img src="'+a+'"></a><p class="nickname">'+t+"</p></div></li>";return $(".signIn_list").prepend(o),!0};var e=new n;Hi.Activity.r("applysign",e)}(jQuery);