!function(){function o(){this.modeName="sign",this.index=0,this.logoWallObj=$("#signinlogo-wall-block .logowall"),this.onWallSignIn=[],this.margin=2,this.showCell=[],this.wallLogoConfig=null,this.wallapplysignConfig=null,this.dbUtil=new Hi.DbUtil(flag,"sign"),this.heartWall={row:15,col:20,squreColor:"#e50150",cellNum:40,showCell:["13*10","13*9","12*11","12*10","12*9","12*8","11*12","11*11","11*10","11*9","11*8","11*7","10*13","10*12","10*11","10*10","10*9","10*8","10*7","10*6","9*15","9*14","9*13","9*12","9*11","9*10","9*9","9*8","9*7","9*6","9*5","9*4","8*16","8*15","8*14","8*13","8*12","8*11","8*10","8*9","8*8","8*7","8*6","8*5","8*4","8*3","7*17","7*16","7*15","7*14","7*13","7*12","7*11","7*10","7*9","7*8","7*7","7*6","7*5","7*4","7*3","7*2","6*18","6*17","6*16","6*15","6*14","6*13","6*12","6*11","6*10","6*9","6*8","6*7","6*6","6*5","6*4","6*3","6*2","6*1","5*18","5*17","5*16","5*15","5*14","5*13","5*12","5*11","5*10","5*9","5*8","5*7","5*6","5*5","5*4","5*3","5*2","5*1","4*18","4*17","4*16","4*15","4*14","4*13","4*12","4*11","4*10","4*9","4*8","4*7","4*6","4*5","4*4","4*3","4*2","4*1","3*18","3*17","3*16","3*15","3*14","3*13","3*12","3*11","3*10","3*9","3*8","3*7","3*6","3*5","3*4","3*3","3*2","3*1","2*17","2*16","2*15","2*14","2*13","2*12","2*11","2*8","2*7","2*6","2*5","2*4","2*3","2*2","1*16","1*15","1*14","1*13","1*12","1*7","1*6","1*5","1*4","1*3","0*15","0*14","0*13","0*6","0*5","0*4"]}}o.prototype.init=function(){var o=$.Deferred(),n=this,l=function(){new Hi.DbUtil(flag,n.modeName).count().then(function(o){$("#signinUserCount span").text(o)})},e=function(){var o=$.Deferred();return Hi.Message.init("sign").always(o.resolve),o.promise()},i=function(){var o=$.Deferred();return Hi.Db.get("global","wallapplysignConfig").then(function(l){n.wallapplysignConfig=l,l.logoDesign&&(n.wallLogoConfig=JSON.parse($.base64.atob(l.logoDesign,!0))),o.resolve()},function(){console.error("查询失败")}),o.promise()},t=function(){var o=$.Deferred();return Hi.Note.r(Hi.Note.type.UPDATE_GLOBAL,function(o){"wallapplysignConfig"==o.noteType&&(n.wallapplysignConfig=o,o.logoDesign&&(n.wallLogoConfig=JSON.parse($.base64.atob(o.logoDesign,!0))),n.resetShowCell(),n.logomatrix())}),Hi.Note.r("new"+n.modeName,function(){l()}),l(),o.resolve(),o.promise()};return e().then(i).then(t).then(function(){o.resolve()}),o.promise()},o.prototype.in=function(){$("#wallcontrol .fr").hide(),$("#play-handle").show().css("opacity","0"),$("#play-handle a").css("pointer-events","none"),Hi.Control.bindEvent();var o=this;$("#signinlogo-wall-block").show(),$("#signinUserCount").show(),Hi.Control.time(3).fn=function(){var n=$.Deferred();return o.nextPage(function(){n.resolve()}),n.promise()},Hi.Control.go()},o.prototype.leave=function(){var o=this;$("#play-handle").css("opacity","1").hide(),$("#play-handle a").css("pointer-events","auto"),o.logoWallObj.find("li").removeClass("rotatein"),$("#signinlogo-wall-block").hide(),$("#signinUserCount").hide(),Hi.Control.stop(),Hi.Control.unbindEvent()},o.prototype.resetShowCell=function(){var o=this;o.wallLogoConfig?o.showCell=$.map(o.wallLogoConfig.showCell,function(o,n){return o}):o.showCell=$.map(o.heartWall.showCell,function(o,n){return o});var n=function(o,n){return Math.random()>.5?-1:1};o.showCell.sort(n)},o.prototype.nextPage=function(o){o||(o=function(){});var n=this;n.dbUtil.getMsg(n.onWallSignIn,"next",1).then(function(l){if(l.length){var e=l[0];n.animation(e.data)&&(n.onWallSignIn.push(e),o&&o())}},function(){console.log("fail")}).always(o)},o.prototype.logomatrix=function(){var o,n,l,e,i,t=this;t.wallLogoConfig?(o=t.wallLogoConfig.col,n=t.wallLogoConfig.row,l=t.wallLogoConfig.squreColor,e=t.wallLogoConfig.cellNum,i=t.wallLogoConfig.showCell):(o=t.heartWall.col,n=t.heartWall.row,l=t.heartWall.squreColor,e=t.heartWall.cellNum,i=t.heartWall.showCell);for(var a="",r=0;r<n;r++){a+="<ul>";for(var s=0;s<o;s++)a+='<li data-axis="'+r+"*"+s+'"></li>';a+="</ul>"}t.logoWallObj.empty().append(a),t.logoWallObj.find("ul").css({width:e*o+"px",height:e}),t.logoWallObj.find("li").css({width:e-t.margin,height:e-t.margin,margin:t.margin/2});for(var s=0;s<i.length;s++)$('li[data-axis="'+i[s]+'"]').addClass("showcell").css("background-color",l);$(".logowall ul li").mouseover(function(){var o=$(this),n=window.innerHeight-o.offset().top;n<210?(o.find("img.tou").css({width:"150px",height:"150px","margin-left":"-90px","margin-top":"-118px"}),o.find("p").css("margin-left","-90px")):o.find("img.tou").css({width:"150px",height:"150px"})}).mouseout(function(){var o=$(this);o.find("img.tou").removeAttr("style")})},o.prototype.animation=function(o){var n=this;if(!o)return!1;var l="/images/wall/unname.jpg";o.imgPath&&(l=Hi.String.dealUrl(o.imgPath));var e=Hi.Wall.getSignUserName(o.id,o.nickName),i=n.showCell.shift();i||(n.resetShowCell(),i=n.showCell.shift());var t=$('li[data-axis="'+i+'"]');if(!t||!t.length)return!1;t.empty();var a='<img class="tou" src="'+l+'">';a+="<p>"+e+"</p>";var r=window.innerHeight-t.offset().top;r<210?t.append(a).addClass("uprotate"):t.append(a).addClass("downrotate");var s=t.children("p")[0];return setTimeout(function(){$(s).fadeIn(200)},300),setTimeout(function(){$(s).fadeOut(200,function(){$(s).removeAttr("style")})},1700),setTimeout(function(){$(t).removeClass("uprotate").removeClass("downrotate")},2e3),!0},Hi.Activity.r("signinlogo",new o)}(jQuery);